## 《高性能MySQL》读书笔记

#### 逻辑架构

MySQL 的逻辑架构分为三层：连接层、服务层和存储引擎层。连接层负责处理客户端连接请求、进行身份验证等操作；服务层负责查询解析、分析、优化和缓存查询结果等操作；存储引擎层负责数据的存储和提取，支持不同的存储引擎，如 InnoDB、MyISAM 等。

#### 并发控制

MySQL 采用多粒度锁机制进行并发控制，包括表级锁和行级锁。表级锁是对整张表进行加锁，适用于大批量更新等操作；行级锁是对数据行进行加锁，适用于并发较高的读写操作。MySQL 中常用的行级锁有共享锁（S 锁）和排它锁（X 锁）。

#### 事务

MySQL 中的事务遵循 ACID 原则，即原子性、一致性、隔离性和持久性。在 MySQL 中，可以通过设置隔离级别来控制事务的隔离程度，包括未提交读（Read Uncommitted）、提交读（Read Committed）、可重复读（Repeatable Read）和串行化（Serializable）四种隔离级别。

#### 多版本并发控制

MySQL 中的多版本并发控制（MVCC）是通过保存数据的历史版本来实现的，读操作可以读取历史版本的数据，而写操作会创建新的版本。MySQL 中实现 MVCC 的方式是通过在每行数据后面添加两个隐藏的列，一个是创建时间（创建版本），一个是过期时间（删除版本），用来判断当前数据版本是否可见。

##### 存储引擎

MySQL 支持多种存储引擎，常用的有 InnoDB、MyISAM 等。其中，InnoDB 是 MySQL 的默认存储引擎，支持事务和行级锁等特性，适合于高并发和数据一致性要求较高的场景。而 MyISAM 不支持事务和行级锁等特性，适合于读操作较多的场景。

#### Schema与数据类型优化

在设计 MySQL 数据库时，需要注意 Schema 的设计和数据类型的选择。Schema 的设计应该遵循范式化原则，避免冗余数据和重复数据，提高数据的存储效率和查询效率。同时，需要根据数据的特性和应用场景选择合适的数据类型。例如，对于存储 IP 地址的字段，可以使用 INT UNSIGNED 类型来存储 IP 地址的数值表示，而不是使用 VARCHAR 类型来存储字符串表示，这样可以提高存储效率和查询效率。

#### 索引 

索引是提高 MySQL 查询效率的重要手段。MySQL 支持多种类型的索引，包括 B-Tree 索引、哈希索引等。其中，B-Tree 索引是最常用的索引类型，适用于范围查询和排序等操作。在使用索引时，需要根据查询语句和数据特性选择合适的索引，同时需要避免过多的索引和冗余的索引，以提高性能和减少存储空间的占用。

#### EXPLAIN 

EXPLAIN 是 MySQL 中用于查询执行计划的命令。通过执行 EXPLAIN 命令，可以查看 MySQL 查询优化器生成的执行计划，包括查询类型、使用的索引、执行顺序等信息。通过分析 EXPLAIN 的输出结果，可以优化查询语句，提高查询效率。

#### 备份与恢复 

备份与恢复是 MySQL 数据库管理中不可或缺的一部分。MySQL 支持多种备份方式，包括物理备份和逻辑备份。物理备份是指直接备份数据文件，包括数据表和索引等，适用于数据量较大的情况；逻辑备份是指备份 SQL 语句，包括 CREATE TABLE 和 INSERT INTO 等操作，适用于数据量较小的情况。在备份与恢复时，需要根据备份策略和业务需求选择合适的备份方式，并保证备份的可靠性和及时性。

#### 高可用性 

MySQL 的高可用性主要通过主从复制和主从切换来实现。主从复制是指将主库上的数据同步到从库，从而实现数据的备份和读写分离；主从切换是指在主库故障时，自动切换到从库来提供服务。MySQL 支持多种主从复制和主从切换的方案，如基于复制日志和基于 GTID 的方案等。

#### MySQL 配置的工作原理 

MySQL 的配置包括全局配置和会话配置两个方面。全局配置是指对整个 MySQL 实例进行配置，包括内存、存储引擎、网络等方面；会话配置是指对每个客户端连接进行配置，包括字符集、缓存大小、超时等方面。MySQL 的配置工作原理是通过读取 my.cnf 配置文件中的配置信息，同时也支持通过命令行参数和 SET 命令进行动态配置。在进行配置时，需要根据实际场景进行调整，以提高性能和稳定性。

